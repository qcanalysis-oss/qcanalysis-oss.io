<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quality Analysis Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
     <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
     <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900">

    <div id="login-page">
        <div class="flex items-center justify-center min-h-screen">
            <div class="w-full max-w-md bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg">
                <div class="flex items-center justify-center mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-500 h-10 w-10"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m9 12 2 2 4-4"></path></svg>
                    <span class="font-bold text-2xl ml-2 text-gray-800 dark:text-gray-200">QualityDeck</span>
                </div>
                <h2 class="text-xl font-bold text-center text-gray-800 dark:text-gray-200 mb-6">Login to your account</h2>
                <div id="login-error" class="hidden bg-red-100 text-red-700 p-3 rounded-md mb-4"></div>
                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="username" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Username</label>
                        <input type="text" id="username" name="username" class="w-full px-3 py-2 border rounded-md bg-gray-50 dark:bg-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" required />
                    </div>
                    <div>
                        <label for="password" class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Password</label>
                        <input type="password" id="password" name="password" class="w-full px-3 py-2 border rounded-md bg-gray-50 dark:bg-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" required />
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-2 px-6 rounded-md hover:bg-indigo-700 transition duration-300">Login</button>
                </form>
            </div>
        </div>
    </div>

    <div id="app-container" class="hidden">
        <!-- Navbar -->
        <nav id="navbar" class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-50">
            <!-- Navbar content will be rendered here -->
        </nav>

        <main class="p-4 sm:p-6 md:p-8">
            <div id="page-content">
                <!-- Dynamic content will be injected here -->
            </div>
        </main>
    </div>

    <script>
        const App = {
            // --- App State & Data ---
            state: {
                currentUser: null,
                currentPage: 'dashboard',
                selectedAuditor: null,
            },

            // --- User Data ---
            users: {
                'QAKoustov': { password: 'Bencos@2025', canAudit: true, auditorId: 'koustav_chatterjee_02' },
                'Pritha': { password: 'Bencos@2025', canAudit: false },
            },

            // --- Data Definitions ---
            qualityAuditors: [
                { uid: 'diya_bose_01', name: 'Diya Bose', agents: ['Tumpa Adhikary', 'Debomita Chakraborty', 'Rumpa Adhikary', 'Aniket Roy', 'Dipankar Saha', 'Diya Jadav', 'Jayeeta Chowdhury', 'Jayanta Paul', 'Debanjan Paul', 'Raj Bhowmick', 'Bikram Jana', 'SK Mijanoor', 'Dipali Mallick', 'Rekha Bansfore', 'Raj Das', 'Balaram Mondal', 'Sudip Mondal', 'Rupam Ghosh', 'Rimpa Dey', 'Shouvik Seal', 'Subhrapati Bisai'] },
                { uid: 'koustav_chatterjee_02', name: 'Koustav Chatterjee', agents: ['Debjit Podder', 'Avik Das', 'Aritri Ghosh', 'Ankan Barman', 'Dwip Paul', 'Mousumi Dey', 'Debmalya Guha', 'Susmita Chakraborty', 'Kiran Ghosh', 'Taniya Roy', 'Priti Saha', 'Sneha Basak', 'Anjali Mallik', 'Sagarika Banarjee', 'Alok Bauri', 'Aparna Mondal', 'Bidisha Mukherjee', 'Mithu Dey', 'Sinjan Das', 'Ankita Shingh', 'Alik Nath'] },
                { uid: 'pallab_gayen_03', name: 'Pallab Gayen', agents: ['Anjali Bhattacharjee', 'Ratan Halder', 'Sayan Byapari', 'Dipanjan Paul', 'Sneha Sarkar', 'Soham Roy', 'Bikash Mahakud', 'Subham Saha', 'Keya Biswas', 'Subhojit Biswas', 'Subhajit Mondal', 'Piyali Das', 'Sampa Modak', 'Prasun Das', 'Bishal Ray', 'Shiuli Pradhan', 'Sudip Biswas', 'Subhojit Sarkar', 'Sagar Sinha', 'Dhrubojyoti'] },
                { uid: 'riya_barui_04', name: 'Riya Barui', agents: ['Sweety Poddar', 'Srabonti Podder', 'Anay Basu Roy', 'Taniya Biswas', 'Debanjana Manna', 'Rohit Goswami', 'Tapas Basak', 'Abhijit Halder', 'Mowmita Paul', 'Sujata Sammader', 'Roni Dey', 'Rahul Paul', 'Krishnendu', 'Ritwika Saha', 'Tubai Dey', 'Bibak Das', 'Sharmila Saha Podder', 'Kiranmay Dey', 'Argha Basak', 'Tamal'] },
                { uid: 'surajit_halder_05', name: 'Surajit Halder', agents: ['Samrit Dutta', 'Nilanjan Das', 'Puja Mallick', 'Suman Mondal', 'Dweep Dey', 'Sumana Manna', 'Subhajit Das', 'Deep Das', 'Joy Roy Chowdhury', 'Biswajit Ghosh', 'Pravash Sarkar', 'Jyoti Thakur', 'Toushik Das', 'Soumen Das', 'Abeg Ghosh', 'Suman Kayal', 'Pijush Kanti Saha', 'Priyanka', 'Swarnadeep', 'Chanchal'] },
                { uid: 'tanaya_debroy_06', name: 'Tanaya Debroy', agents: ['Arpan Dutta', 'Kanchan kumar Ram', 'Subrata Das', 'Lovely Dasgupta', 'Rahul Debnath', 'Arijit Das', 'Bishal Seal', 'Pampairani Katari', 'Aishwary Dey', 'Puja Pule', 'Samar Saren', 'Alimpa Paul', 'Ranita Ghosh', 'Moumita Sarkar', 'Rana Goswami', 'Nilanjan Paul', 'Sagar Saha', 'Jyoti Biswas', 'Parthiv Basu'] },
            ],
            supervisors: [
                { uid: 'arup_banerjee_s1', name: 'Arup Banerjee', teamId: 'team_arup' },
                { uid: 'bhagyashree_saha_s2', name: 'Bhagyashree Saha', teamId: 'team_bhagyashree' },
                { uid: 'krishnendu_pal_s3', name: 'Krishnendu Pal', teamId: 'team_krishnendu' },
                { uid: 'lucky_roy_s4', name: 'Lucky Roy', teamId: 'team_lucky' },
                { uid: 'salini_podder_s5', name: 'Salini Podder', teamId: 'team_salini' },
                { uid: 'sayan_biswas_s6', name: 'Sayan Biswas', teamId: 'team_sayan' },
                { uid: 'soumendra_nath_das_s7', name: 'Soumendra Nath Das', teamId: 'team_soumendra' },
                { uid: 'subhojit_das_s8', name: 'Subhojit Das', teamId: 'team_subhojit' },
                { uid: 'tuhin_giri_s9', name: 'Tuhin Giri', teamId: 'team_tuhin' },
            ],
            scoringParameters: [
                { id: 'timelyManner', text: "Did the agent respond to the player in a timely manner?", points: 10, partialPoints: 5 },
                { id: 'securityProtocols', text: "Did the agent follow proper security and account verification protocols?", points: 10, partialPoints: 5 },
                { id: 'professionalInteraction', text: "Did the agent handle the interaction professionally and respectfully?", points: 10 },
                { id: 'empathy', text: "Did the agent show empathy and care when addressing the player's concerns?", points: 10 },
                { id: 'understandAndRespond', text: "Did the agent understand the player's concern and provide accurate and confident responses?", points: 20, partialPoints: 10 },
                { id: 'interactionProcedures', text: "Did the agent adhere to proper interaction procedures?", points: 20 },
                { id: 'resolveIssue', text: "Did the agent resolve the player's issue or provide alternative options if a solution wasn't possible?", points: 5 },
                { id: 'upsell', text: "Did the agent upsell promotions or new products where appropriate?", points: 5 },
                { id: 'thankPlayer', text: "Did the agent thank the player for his time and his business with us?", points: 5 },
                { id: 'satisfied', text: "Was the player satisfied with the service provided?", points: 5, partialPoints: 2.5 },
            ],

            // --- Initialization ---
            init() {
                this.state.selectedAuditor = this.qualityAuditors[0];
                this.initLogin();
                
                if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            },

            // --- UI & Event Handling ---
            initTheme() {
                const themeToggle = document.getElementById('theme-toggle');
                if (!themeToggle) return;
                const lightIcon = document.getElementById('theme-icon-light');
                const darkIcon = document.getElementById('theme-icon-dark');
                
                const apply = () => {
                    if (document.documentElement.classList.contains('dark')) {
                        darkIcon.classList.remove('hidden');
                        lightIcon.classList.add('hidden');
                    } else {
                        darkIcon.classList.add('hidden');
                        lightIcon.classList.remove('hidden');
                    }
                };
                
                themeToggle.addEventListener('click', () => {
                    document.documentElement.classList.toggle('dark');
                    localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                    apply();
                });
                apply();
            },

            initLogin() {
                const loginForm = document.getElementById('login-form');
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const username = e.target.username.value;
                    const password = e.target.password.value;
                    const user = this.users[username];
                    const errorDiv = document.getElementById('login-error');

                    if (user && user.password === password) {
                        this.state.currentUser = { id: username, ...user };
                        if (user.auditorId) {
                            this.state.selectedAuditor = this.qualityAuditors.find(qa => qa.uid === user.auditorId) || this.qualityAuditors[0];
                        }
                        document.getElementById('login-page').classList.add('hidden');
                        document.getElementById('app-container').classList.remove('hidden');
                        
                        this.initNavigation();
                        this.navigate('dashboard');
                    } else {
                        errorDiv.textContent = 'Invalid username or password.';
                        errorDiv.classList.remove('hidden');
                    }
                });
            },

            initNavigation() {
                const navbar = document.getElementById('navbar');
                navbar.innerHTML = this.getNavbarHTML();
                this.initTheme();
                navbar.addEventListener('click', (e) => {
                    const navButton = e.target.closest('[data-nav]');
                    const logoutButton = e.target.closest('#logout-btn');
                    if (navButton) {
                        this.navigate(navButton.dataset.nav);
                    }
                    if (logoutButton) {
                        this.logout();
                    }
                });
            },
            
            logout() {
                this.state.currentUser = null;
                document.getElementById('login-page').classList.remove('hidden');
                document.getElementById('app-container').classList.add('hidden');
                document.getElementById('login-form').reset();
                document.getElementById('login-error').classList.add('hidden');
            },

            navigate(page) {
                if (page === 'audit' && !this.state.currentUser.canAudit) {
                    this.state.currentPage = 'dashboard';
                } else {
                    this.state.currentPage = page;
                }
                this.render();
            },
            
            render() {
                const content = document.getElementById('page-content');
                if (this.state.currentPage === 'dashboard') {
                    content.innerHTML = this.getDashboardHTML();
                } else if (this.state.currentPage === 'audit') {
                    content.innerHTML = this.getAuditFormHTML();
                    this.attachAuditFormListeners();
                }
            },

            // --- HTML Template Generation ---
            getNavbarHTML() {
                return `
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-16">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-500 h-8 w-8"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m9 12 2 2 4-4"></path></svg>
                            <span class="font-bold text-xl ml-2 text-gray-800 dark:text-gray-200">QualityDeck</span>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="text-gray-600 dark:text-gray-300">Welcome, ${this.state.currentUser.id}</span>
                            <button data-nav="dashboard" class="text-gray-600 dark:text-gray-300 hover:text-indigo-500 dark:hover:text-indigo-400 px-3 py-2 rounded-md text-sm font-medium">Dashboard</button>
                            ${this.state.currentUser.canAudit ? `<button data-nav="audit" class="bg-indigo-600 text-white px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-700">New Audit</button>` : ''}
                            <button id="logout-btn" class="text-gray-600 dark:text-gray-300 hover:text-indigo-500 dark:hover:text-indigo-400 px-3 py-2 rounded-md text-sm font-medium">Logout</button>
                            <button id="theme-toggle" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700">
                                <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                                <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                            </button>
                        </div>
                    </div>
                </div>`;
            },

            getDashboardHTML() {
                return `
                    <div class="space-y-8">
                        <div class="flex flex-wrap justify-between items-center gap-4">
                            <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200">Dashboard</h1>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-4">Audit Data</h3>
                            <p class="text-gray-600 dark:text-gray-400">
                                All submitted audit data is now being saved directly to your Google Sheet. Please check your sheet to view the reports and analyze the data.
                            </p>
                        </div>
                    </div>`;
            },

            getAuditFormHTML() {
                const currentAuditor = this.state.selectedAuditor;
                const agentOptions = currentAuditor.agents.map(agent => `<option value="${agent}">${agent}</option>`).join('');

                return `
                <div class="max-w-4xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-6">Chat Audit</h2>
                    <div id="form-messages"></div>
                    <form id="audit-form" class="space-y-8">
                        <section>
                            <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4 border-b pb-2 dark:border-gray-600">Case Details</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Auditor Name</label><input type="text" name="entry.auditorName" value="${currentAuditor.name}" readonly class="w-full px-3 py-2 border rounded-md bg-gray-200 dark:bg-gray-600 dark:text-gray-300 border-gray-300 dark:border-gray-500" /></div>
                                <div><label class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Agent Name</label><select name="entry.agentName" class="w-full px-3 py-2 border rounded-md bg-gray-50 dark:bg-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" required><option value="">Select an Agent</option>${agentOptions}</select></div>
                                <div><label class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Team (Supervisor)</label><select name="entry.teamId" class="w-full px-3 py-2 border rounded-md bg-gray-50 dark:bg-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" required><option value="">Select a Team</option>${this.supervisors.map(s => `<option value="${s.teamId}">${s.name}</option>`).join('')}</select></div>
                                <div><label class="block text-gray-700 dark:text-gray-300 font-medium mb-1">Chat ID / Customer ID</label><input type="text" name="entry.chatId" class="w-full px-3 py-2 border rounded-md bg-gray-50 dark:bg-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" required /></div>
                                <div class="md:col-span-2"><label class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Audit Type</label><div class="flex items-center space-x-6"><label class="flex items-center cursor-pointer"><input type="radio" name="entry.auditType" value="internal" checked class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500" /><span class="ml-2 text-gray-700 dark:text-gray-300">Internal</span></label><label class="flex items-center cursor-pointer"><input type="radio" name="entry.auditType" value="external" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500" /><span class="ml-2 text-gray-700 dark:text-gray-300">External</span></label></div></div>
                                <div class="md:col-span-2"><label class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Contact Reason</label><div class="grid grid-cols-2 sm:grid-cols-3 gap-2">${['Deposit', 'Withdraw', 'Promotions', 'Accounts', 'Games'].map(reason => `<label class="flex items-center"><input type="checkbox" name="entry.contactReason" value="${reason}" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" /><span class="ml-2 text-gray-700 dark:text-gray-300">${reason}</span></label>`).join('')}</div></div>
                            </div>
                        </section>
                        <section>
                            <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4 border-b pb-2 dark:border-gray-600">Scoring Parameters</h3>
                            <div class="space-y-4">${this.scoringParameters.map(param => `
                                <div class="p-4 rounded-md bg-gray-50 dark:bg-gray-700/50">
                                    <label class="block text-gray-800 dark:text-gray-200 font-medium">${param.text} <span class="text-sm font-normal text-gray-500 dark:text-gray-400">(${param.points} points)</span></label>
                                    <div class="flex items-center space-x-6 mt-2">
                                        <label class="flex items-center cursor-pointer"><input type="radio" name="entry.${param.id}" value="yes" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500" /><span class="ml-2 text-gray-700 dark:text-gray-300">Yes</span></label>
                                        <label class="flex items-center cursor-pointer"><input type="radio" name="entry.${param.id}" value="no" class="h-4 w-4 text-red-600 border-gray-300 focus:ring-red-500" /><span class="ml-2 text-gray-700 dark:text-gray-300">No</span></label>
                                        ${param.partialPoints ? `<label class="flex items-center cursor-pointer"><input type="radio" name="entry.${param.id}" value="partial" class="h-4 w-4 text-yellow-500 border-gray-300 focus:ring-yellow-400" /><span class="ml-2 text-gray-700 dark:text-gray-300">Partial (${param.partialPoints} pts)</span></label>` : ''}
                                        <label class="flex items-center cursor-pointer"><input type="radio" name="entry.${param.id}" value="na" checked class="h-4 w-4 text-gray-500 border-gray-300 focus:ring-gray-400" /><span class="ml-2 text-gray-700 dark:text-gray-300">N/A</span></label>
                                    </div>
                                </div>`).join('')}
                            </div>
                        </section>
                        <section>
                             <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4 border-b pb-2 dark:border-gray-600">Coaching & Feedback</h3>
                            <div class="space-y-4">
                                <div><label class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Please select on what the agent needs to be coached at.</label><div class="grid grid-cols-2 sm:grid-cols-3 gap-2">${['Chat Handling', 'Product knowledge', 'Process Adherence', 'Communication Style', 'Others'].map(area => `<label class="flex items-center"><input type="radio" name="entry.coachingArea" value="${area}" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500" /><span class="ml-2 text-gray-700 dark:text-gray-300">${area}</span></label>`).join('')}</div></div>
                                <div><label class="block text-gray-700 dark:text-gray-300 font-medium mb-1">If "Others" please elaborate.</label><textarea name="entry.coachingComments" rows="3" class="w-full px-3 py-2 border rounded-md bg-gray-50 dark:bg-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea></div>
                                <div><label class="block text-gray-700 dark:text-gray-300 font-medium mb-1">General Remarks & Feedback</label><textarea name="entry.remarks" rows="4" class="w-full px-3 py-2 border rounded-md bg-gray-50 dark:bg-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea></div>
                            </div>
                        </section>
                        <div class="text-right pt-4"><button type="submit" id="submit-audit" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-md hover:bg-indigo-700 disabled:bg-indigo-300 transition duration-300">Submit Audit</button></div>
                    </form>
                </div>`;
            },

            attachAuditFormListeners() {
                document.getElementById('audit-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const form = e.target;
                    const formData = new FormData(form);
                    const formMessages = document.getElementById('form-messages');
                    const submitButton = document.getElementById('submit-audit');
                    
                    const GOOGLE_FORM_ACTION_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSdHhAeW_WfwXaA9laD4Ef4eiC_SxFL59fcGXfYR8y7tJni63w/formResponse';

                    // Manually add total score to form data
                    let totalScore = 0;
                    this.scoringParameters.forEach(param => {
                        const value = formData.get(`entry.${param.id}`);
                        if (value === 'yes') totalScore += param.points;
                        if (value === 'partial') totalScore += param.partialPoints || 0;
                    });
                    formData.append('entry.totalScore', totalScore);
                    
                    submitButton.disabled = true;
                    submitButton.textContent = 'Submitting...';

                    try {
                        await fetch(GOOGLE_FORM_ACTION_URL, {
                            method: 'POST',
                            body: formData,
                            mode: 'no-cors' // Important for Google Forms
                        });
                        formMessages.innerHTML = `<p class="bg-green-100 text-green-700 p-3 rounded-md mb-4">Audit submitted successfully to Google Sheet!</p>`;
                        form.reset();
                        setTimeout(() => this.navigate('dashboard'), 2000);
                    } catch (err) {
                        formMessages.innerHTML = `<p class="bg-red-100 text-red-700 p-3 rounded-md mb-4">Failed to submit audit. Please try again.</p>`;
                        console.error("Form submission error:", err);
                    } finally {
                        submitButton.disabled = false;
                        submitButton.textContent = 'Submit Audit';
                    }
                });
            }
        };

        App.init();
    </script>
</body>
</html>
